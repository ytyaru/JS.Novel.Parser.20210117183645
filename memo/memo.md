# interface

　パーサを生成するインタフェースを考える。

## Factoryパターン

```javascript
const parser = ParserFactory.create();
```

　生成には専用クラス＋メソッドを用いるようにしたい。これはユースケースに合わせる。

* 中間テキスト->HTML
    * SiteSpec
        * カクヨム
        * なろう
    * Rule
        * 二重山括弧
        * 括弧
* プレーンテキスト->中間テキスト
    * Rule
        * 括弧

# 生成パターン

* サイトの仕様を再現する
* サイトの仕様のうちユーザが選択できる所を再現する
* ユーザが独自仕様をつくる

## カクヨム

* ルビ
    * 二重山括弧（縦棒の全角・半角。ベース文字数50まで。ルビ文字20まで）
    * 縦棒省略形（ベース文字種＝漢字）
    * エスケープ

　変数にしたい所が９つある。

* メタ文字
    * 囲い文字：（）｟ ｠「」『』［ ］〚 〛｛ ｝〔 〕〘 〙〈 〉《 》« »【 】〖 〗’’”” https://gaku-sha.com/word/kakko
    * 始点文字：｜
* メタ文字全半角：全角／半角／両方
* `<rb>`文字種：なんでもあり／漢字のみ
* `<rt>`文字種：ひらがな、カタカナ、組み合わせ、なんでもあり
* `<rb>`文字数：10,50,任意
* `<rt>`文字数：20,任意
* エスケープ：有／無
* 始点省略形：有／無
* 出力：`<ruby>...`, `｜漢字《かんじ》`, `漢字（かんじ）`

　基本的に以下パターンのみ。

```
｜漢字《かんじ》
|漢字《かんじ》
漢字《かんじ》

｜漢字（かんじ）
|漢字（かんじ）
漢字（かんじ）

｜漢字(かんじ)
|漢字(かんじ)
漢字(かんじ)
```

* 囲み文字：`《》`,`（）`,`()`
* 始点文字：`｜`, `|`
    * 有：`<rb>`文字種＝不問
    * 無：`<rb>`文字種＝漢字のみ
* `<rt>`文字種
    * 不問
    * ひらがな｜カタカナ

## Builderパターン

```javascript
class Builder {
    #rules;
    constructor(rules) {
        this.#rules = rules; // ルールクラスの配列
    }
    parse(text) {
        for (const rule of this.#rules) {
            text = rule.parse(text);
        }
        return text;
    }
}
```

　ビルダーはルールの配列を持っている。順序にもとづきパースする。

　ルールは`parse`メソッドを持っている。

```javascript
class Rule {
    parse(text) {
        ...
        return text;
    }
}
```
```javascript
```

```javascript
```

```javascript
```

```javascript
```

```javascript
```


　パーサルールの生成にはデザインパターンのBuilderを用いる。



